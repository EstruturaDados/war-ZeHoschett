#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// Estrutura que representa uma sala da mans√£o
typedef struct Sala {
    char nome[50];
    struct Sala *esquerda;
    struct Sala *direita;
} Sala;

// ================================
// Fun√ß√£o: criarSala()
// Cria dinamicamente uma nova sala com o nome especificado
// ================================
Sala* criarSala(const char *nome) {
    Sala *novaSala = (Sala*) malloc(sizeof(Sala));
    if (novaSala == NULL) {
        printf("Erro ao alocar mem√≥ria!\n");
        exit(1);
    }
    strcpy(novaSala->nome, nome);
    novaSala->esquerda = NULL;
    novaSala->direita = NULL;
    return novaSala;
}

// ================================
// Fun√ß√£o: explorarSalas()
// Permite a navega√ß√£o do jogador pela √°rvore (mans√£o)
// Retorna 1 se o jogador quiser explorar novamente, 0 se quiser sair
// ================================
int explorarSalas(Sala *raiz) {
    Sala *atual = raiz;
    char escolha;

    printf("\nVoc√™ est√° no %s.\n", atual->nome);

    while (1) {
        // Se for uma sala sem sa√≠das (folha)
        if (atual->esquerda == NULL && atual->direita == NULL) {
            printf("\nVoc√™ chegou ao fim da explora√ß√£o!\n");
            printf("O c√¥modo '%s' n√£o possui mais caminhos.\n", atual->nome);
            printf("\nDeseja voltar ao Hall de entrada? (s/n): ");
            scanf(" %c", &escolha);
            if (escolha == 's' || escolha == 'S') {
                atual = raiz; // volta para o in√≠cio
                printf("\nVoc√™ retornou ao %s.\n", atual->nome);
            } else {
                return 0; // encerra o jogo
            }
        }

        printf("\nEscolha um caminho a seguir:\n");
        if (atual->esquerda != NULL)
            printf(" [e] Ir para %s (esquerda)\n", atual->esquerda->nome);
        if (atual->direita != NULL)
            printf(" [d] Ir para %s (direita)\n", atual->direita->nome);
        printf(" [s] Sair da mans√£o\n");
        printf("Op√ß√£o: ");
        scanf(" %c", &escolha);

        if (escolha == 'e' && atual->esquerda != NULL) {
            atual = atual->esquerda;
            printf("\nVoc√™ entrou em: %s\n", atual->nome);
        } 
        else if (escolha == 'd' && atual->direita != NULL) {
            atual = atual->direita;
            printf("\nVoc√™ entrou em: %s\n", atual->nome);
        } 
        else if (escolha == 's' || escolha == 'S') {
            printf("\nVoc√™ decidiu encerrar sua explora√ß√£o.\n");
            return 0;
        } 
        else {
            printf("Op√ß√£o inv√°lida! Tente novamente.\n");
        }
    }
}

// ================================
// Fun√ß√£o: liberarArvore()
// Libera a mem√≥ria alocada pela √°rvore bin√°ria (recursiva)
// ================================
void liberarArvore(Sala *raiz) {
    if (raiz == NULL) return;
    liberarArvore(raiz->esquerda);
    liberarArvore(raiz->direita);
    free(raiz);
}

// ================================
// Fun√ß√£o principal: main()
// Monta a estrutura fixa da mans√£o e inicia a explora√ß√£o
// ================================
int main() {
    // Cria√ß√£o das salas (n√≥s da √°rvore)
    Sala *hall = criarSala("Hall de entrada");
    Sala *salaEstar = criarSala("Sala de estar");
    Sala *cozinha = criarSala("Cozinha");
    Sala *biblioteca = criarSala("Biblioteca");
    Sala *jardim = criarSala("Jardim");
    Sala *porao = criarSala("Por√£o");

    // Conex√µes entre as salas
    hall->esquerda = salaEstar;
    hall->direita = cozinha;
    salaEstar->esquerda = biblioteca;
    salaEstar->direita = jardim;
    cozinha->direita = porao;

    // Introdu√ß√£o do jogo
    printf("===========================================\n");
    printf("     üé© DETECTIVE QUEST: A MANS√ÉO MISTERIOSA\n");
    printf("===========================================\n");
    printf("Voc√™ acaba de entrar em uma antiga mans√£o...\n");
    printf("Seu objetivo √© explorar cada c√¥modo e descobrir seus segredos.\n");
    printf("-------------------------------------------\n");

    int continuar = 1;

    while (continuar) {
        continuar = explorarSalas(hall);

        if (continuar == 0) {
            char resp;
            printf("\nDeseja iniciar uma nova explora√ß√£o? (s/n): ");
            scanf(" %c", &resp);
            if (resp == 's' || resp == 'S')
                continuar = 1;
            else
                continuar = 0;
        }
    }

    printf("\nObrigado por jogar Detective Quest!\n");
    printf("Volte em breve para novas investiga√ß√µes. üïµÔ∏è‚Äç‚ôÇÔ∏è\n");

    liberarArvore(hall);
    return 0;
}
